<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Deal Oversight Dashboard - SpaceX Mission Control</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&family=Roboto+Mono:wght@400;500&display=swap" rel="stylesheet">
    <style>
        /* ========================================
           SpaceX Mission Control Theme
           ======================================== */
        :root {
            --bg-primary: #0b0b0f;
            --bg-secondary: #1a1a1e;
            --bg-panel: #141418;
            --bg-hover: #252529;
            --accent-blue: #005288;
            --accent-cyan: #00bcd4;
            --alert-red: #c41e3a;
            --success-green: #00c853;
            --warning-yellow: #ffc107;
            --warning-orange: #ff8800;
            --text-primary: #ffffff;
            --text-secondary: #9e9e9e;
            --text-muted: #666666;
            --border-color: #2a2a2e;
            --shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Roboto', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            line-height: 1.5;
        }

        /* ========================================
           Header
           ======================================== */
        .header {
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border-color);
            padding: 12px 24px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .logo-section {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .property-selector-row {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .header-icon-btn {
            width: 32px;
            height: 32px;
            border: none;
            border-radius: 6px;
            background: transparent;
            color: var(--accent-cyan);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .header-icon-btn:hover {
            background: var(--bg-hover);
        }

        .header-icon-btn svg {
            width: 18px;
            height: 18px;
        }

        .header-icon-btn.small {
            width: 28px;
            height: 28px;
        }

        .header-icon-btn.small svg {
            width: 16px;
            height: 16px;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .logo-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--accent-blue), var(--accent-cyan));
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 18px;
        }

        .logo-text {
            font-weight: 500;
            font-size: 18px;
        }

        .logo-text span {
            color: var(--text-secondary);
            font-weight: 300;
        }

        .property-selector {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .property-selector select {
            background: var(--bg-panel);
            border: 1px solid var(--border-color);
            color: var(--text-primary);
            padding: 10px 16px;
            border-radius: 6px;
            font-size: 14px;
            min-width: 300px;
            cursor: pointer;
        }

        .property-selector select:focus {
            outline: none;
            border-color: var(--accent-cyan);
        }

        /* Property dropdown with urgency dots */
        .property-dropdown {
            position: relative;
        }

        .property-dropdown-btn {
            background: var(--bg-panel);
            border: 1px solid var(--border-color);
            color: var(--text-primary);
            padding: 10px 16px;
            border-radius: 6px;
            font-family: 'Roboto Mono', monospace;
            font-size: 13px;
            font-weight: 500;
            letter-spacing: 0.3px;
            min-width: 340px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 12px;
        }

        .property-dropdown-btn:hover {
            border-color: var(--accent-cyan);
        }

        .property-dropdown-content {
            display: none;
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            margin-top: 4px;
            z-index: 200;
            box-shadow: var(--shadow);
        }

        .property-dropdown.open .property-dropdown-content {
            display: block;
        }

        .property-option {
            padding: 12px 16px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 12px;
            transition: background 0.2s;
            font-family: 'Roboto Mono', monospace;
            font-size: 13px;
        }

        .property-option:hover {
            background: var(--bg-hover);
        }

        .property-option.selected {
            background: var(--bg-panel);
        }

        .urgency-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            flex-shrink: 0;
        }

        .urgency-dot.danger { background: var(--alert-red); animation: pulse 1s infinite; }
        .urgency-dot.warning { background: var(--warning-orange); }
        .urgency-dot.caution { background: var(--warning-yellow); }
        .urgency-dot.safe { background: var(--success-green); }

        /* County link - clickable */
        .county-link {
            color: var(--accent-cyan);
            cursor: pointer;
            text-decoration: underline;
            text-decoration-style: dotted;
        }

        .county-link:hover {
            color: var(--text-primary);
        }

        /* County Links Slide-out Panel */
        .county-panel-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 500;
        }

        .county-panel-overlay.open {
            display: block;
        }

        .county-panel {
            position: fixed;
            top: 0;
            right: -400px;
            width: 400px;
            height: 100vh;
            background: var(--bg-secondary);
            border-left: 1px solid var(--border-color);
            z-index: 501;
            transition: right 0.3s ease;
            overflow-y: auto;
        }

        .county-panel-overlay.open .county-panel {
            right: 0;
        }

        .county-panel-header {
            padding: 20px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .county-panel-title {
            font-size: 18px;
            font-weight: 500;
        }

        .county-panel-close {
            width: 32px;
            height: 32px;
            border: none;
            background: var(--bg-panel);
            color: var(--text-secondary);
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .county-panel-close:hover {
            color: var(--text-primary);
            background: var(--bg-hover);
        }

        .county-panel-content {
            padding: 20px;
        }

        .county-link-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 16px;
            background: var(--bg-panel);
            border-radius: 6px;
            margin-bottom: 12px;
            text-decoration: none;
            color: var(--text-primary);
            transition: all 0.2s;
        }

        .county-link-item:hover {
            background: var(--bg-hover);
            transform: translateX(4px);
        }

        .county-link-icon {
            width: 40px;
            height: 40px;
            background: var(--accent-blue);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .county-link-icon svg {
            width: 20px;
            height: 20px;
            color: white;
        }

        .county-link-text {
            flex: 1;
        }

        .county-link-name {
            font-weight: 500;
            margin-bottom: 2px;
        }

        .county-link-desc {
            font-size: 12px;
            color: var(--text-secondary);
        }

        /* ========================================
           Countdown Box
           ======================================== */
        .countdown-container {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .countdown-box {
            background: var(--bg-panel);
            border: 2px solid var(--alert-red);
            border-radius: 8px;
            padding: 12px 20px;
            text-align: center;
            min-width: 200px;
            transition: all 0.3s ease;
        }

        .countdown-box.urgent {
            animation: urgentFlash 1s ease-in-out infinite;
        }

        .countdown-box.resolved {
            border-color: var(--success-green);
            animation: none;
        }

        @keyframes urgentFlash {
            0%, 100% {
                background: var(--bg-panel);
                box-shadow: 0 0 20px rgba(196, 30, 58, 0.3);
            }
            50% {
                background: rgba(196, 30, 58, 0.2);
                box-shadow: 0 0 40px rgba(196, 30, 58, 0.5);
            }
        }

        .countdown-days {
            font-size: 32px;
            font-weight: 700;
            font-family: 'Roboto Mono', monospace;
            color: var(--alert-red);
        }

        .countdown-box.resolved .countdown-days {
            color: var(--success-green);
        }

        .countdown-label {
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--text-secondary);
            margin-top: 4px;
        }

        .countdown-status {
            font-size: 12px;
            font-weight: 500;
            margin-top: 8px;
            padding: 4px 12px;
            border-radius: 4px;
            display: inline-block;
        }

        .countdown-status.unpaid {
            background: rgba(196, 30, 58, 0.2);
            color: var(--alert-red);
        }

        .countdown-status.paid {
            background: rgba(0, 200, 83, 0.2);
            color: var(--success-green);
        }

        /* ========================================
           Main Layout
           ======================================== */
        .main-container {
            display: grid;
            grid-template-columns: 420px 1fr;
            gap: 0;
            min-height: calc(100vh - 65px);
        }

        @media (max-width: 1200px) {
            .main-container {
                grid-template-columns: 1fr;
            }
        }

        /* ========================================
           Checklist Panel (Left)
           ======================================== */
        .checklist-panel {
            background: var(--bg-primary);
            border-left: 1px solid var(--border-color);
            overflow-y: auto;
            max-height: calc(100vh - 65px);
        }

        .checklist-header {
            padding: 20px;
            border-bottom: 1px solid var(--border-color);
            position: sticky;
            top: 0;
            background: var(--bg-secondary);
            z-index: 10;
        }

        .checklist-title {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 12px;
        }

        .checklist-title h2 {
            font-size: 16px;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .completion-badge {
            font-family: 'Roboto Mono', monospace;
            font-size: 14px;
            font-weight: 500;
            color: var(--success-green);
        }

        .progress-bar {
            height: 6px;
            background: var(--bg-panel);
            border-radius: 3px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--success-green), var(--accent-cyan));
            border-radius: 3px;
            transition: width 0.5s ease;
        }

        /* ========================================
           Accordion Sections
           ======================================== */
        .section {
            border-bottom: 1px solid var(--border-color);
        }

        .section-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px 20px;
            cursor: pointer;
            transition: background 0.2s ease;
            user-select: none;
        }

        .section-header:hover {
            background: var(--bg-hover);
        }

        .section-header-left {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .section-chevron {
            width: 20px;
            height: 20px;
            transition: transform 0.3s ease;
            color: var(--text-secondary);
        }

        .section.expanded .section-chevron {
            transform: rotate(90deg);
        }

        .section-name {
            font-size: 14px;
            font-weight: 500;
        }

        .section-count {
            font-size: 12px;
            color: var(--text-secondary);
            font-family: 'Roboto Mono', monospace;
        }

        .section-progress-ring {
            width: 32px;
            height: 32px;
        }

        .section-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
            background: var(--bg-panel);
        }

        .section.expanded .section-content {
            max-height: 2000px;
        }

        /* ========================================
           Task Items
           ======================================== */
        .task-item {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            padding: 12px 20px 12px 48px;
            border-bottom: 1px solid var(--border-color);
            transition: background 0.2s ease;
        }

        .task-item:hover {
            background: var(--bg-hover);
        }

        .task-item:last-child {
            border-bottom: none;
        }

        .task-checkbox {
            width: 24px;
            height: 24px;
            min-width: 24px;
            border: 2px solid var(--text-muted);
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            margin-top: 2px;
        }

        .task-checkbox:hover {
            border-color: var(--accent-cyan);
        }

        .task-checkbox.checked {
            background: var(--success-green);
            border-color: var(--success-green);
        }

        .task-checkbox.checked svg {
            opacity: 1;
        }

        .task-checkbox svg {
            width: 14px;
            height: 14px;
            color: white;
            opacity: 0;
            transition: opacity 0.2s ease;
        }

        .task-content {
            flex: 1;
        }

        .task-name {
            font-size: 14px;
            margin-bottom: 4px;
        }

        .task-item.completed .task-name {
            text-decoration: line-through;
            color: var(--text-secondary);
        }

        .task-meta {
            display: flex;
            align-items: center;
            gap: 8px;
            flex-wrap: wrap;
        }

        .task-due {
            font-size: 11px;
            font-family: 'Roboto Mono', monospace;
            padding: 2px 8px;
            border-radius: 3px;
            background: var(--bg-secondary);
        }

        .task-due.overdue {
            background: rgba(196, 30, 58, 0.2);
            color: var(--alert-red);
            animation: pulse 2s ease-in-out infinite;
        }

        .task-due.warning {
            background: rgba(255, 136, 0, 0.2);
            color: var(--warning-orange);
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }

        .task-owner {
            font-size: 10px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            padding: 2px 8px;
            border-radius: 3px;
            font-weight: 500;
        }

        .task-owner.muce {
            background: rgba(0, 82, 136, 0.3);
            color: #4da6ff;
        }

        .task-owner.c2c {
            background: rgba(0, 188, 212, 0.2);
            color: var(--accent-cyan);
        }

        /* 14-day ownership border colors */
        .task-item.muce-owned {
            border-left: 3px solid var(--accent-blue);
            padding-left: 45px;
        }

        .task-item.c2c-owned {
            border-left: 3px solid var(--accent-cyan);
            padding-left: 45px;
        }

        /* Section header with owner indicator */
        .section-owner-badge {
            font-size: 10px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            padding: 3px 8px;
            border-radius: 3px;
            font-weight: 500;
            margin-left: 8px;
        }

        .section-owner-badge.muce {
            background: rgba(0, 82, 136, 0.3);
            color: #4da6ff;
        }

        .section-owner-badge.c2c {
            background: rgba(0, 188, 212, 0.2);
            color: var(--accent-cyan);
        }

        /* Executed Docs - green when checked */
        .task-item.doc-checked .task-name {
            color: var(--success-green);
            text-decoration: none;
        }

        .task-item.doc-checked .task-checkbox {
            background: var(--success-green);
            border-color: var(--success-green);
        }

        /* N/A toggle for documents */
        .task-na-toggle {
            font-size: 10px;
            padding: 2px 6px;
            border-radius: 3px;
            cursor: pointer;
            background: var(--bg-secondary);
            color: var(--text-muted);
            border: 1px solid var(--border-color);
            transition: all 0.2s;
        }

        .task-na-toggle:hover {
            border-color: var(--text-muted);
        }

        .task-na-toggle.active {
            background: rgba(158, 158, 158, 0.3);
            color: var(--text-secondary);
            border-color: var(--text-secondary);
        }

        .task-item.na-marked {
            opacity: 0.5;
        }

        .task-item.na-marked .task-name {
            text-decoration: line-through;
            color: var(--text-muted);
        }

        /* Gmail compose link button */
        .task-email-btn {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            font-size: 10px;
            padding: 3px 8px;
            border-radius: 3px;
            background: rgba(234, 67, 53, 0.2);
            color: #ea4335;
            text-decoration: none;
            transition: all 0.2s;
        }

        .task-email-btn:hover {
            background: rgba(234, 67, 53, 0.3);
        }

        .task-email-btn svg {
            width: 12px;
            height: 12px;
        }

        /* ========================================
           Details Panel (Left)
           ======================================== */
        .details-panel {
            background: var(--bg-secondary);
            padding: 28px 24px;
            overflow-y: auto;
            max-height: calc(100vh - 65px);
        }

        .property-header {
            margin-bottom: 28px;
        }

        .property-address-row {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 6px;
        }

        .property-address {
            font-size: 22px;
            font-weight: 500;
            line-height: 1.3;
            margin: 0;
        }

        .property-location {
            font-size: 14px;
            color: var(--text-secondary);
            line-height: 1.5;
            margin: 0;
        }

        .info-grid {
            display: flex;
            flex-direction: column;
            gap: 24px;
            margin-bottom: 24px;
        }

        .info-card {
            background: var(--bg-panel);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 20px;
        }

        .info-card-title {
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            color: var(--text-secondary);
            margin-bottom: 18px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border-color);
        }

        .info-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid var(--border-color);
        }

        .info-row:last-child {
            border-bottom: none;
            padding-bottom: 0;
        }

        .info-row:first-child {
            padding-top: 0;
        }

        .info-label {
            font-size: 14px;
            color: var(--text-secondary);
        }

        .info-value {
            font-size: 15px;
            font-weight: 500;
            text-align: right;
        }

        .info-value.highlight {
            color: var(--accent-cyan);
        }

        .info-value.amount {
            font-family: 'Roboto Mono', monospace;
            color: var(--success-green);
        }

        .status-badge {
            padding: 4px 12px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
        }

        .status-badge.yes {
            background: rgba(0, 200, 83, 0.2);
            color: var(--success-green);
        }

        .status-badge.no {
            background: rgba(102, 102, 102, 0.2);
            color: var(--text-secondary);
        }

        /* ========================================
           Contacts Section
           ======================================== */
        .contact-section {
            margin-bottom: 20px;
        }

        .contact-section:last-child {
            margin-bottom: 0;
        }

        .contact-section-header {
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--text-muted);
            padding: 10px 0 8px;
            border-bottom: 1px dashed var(--border-color);
            margin-bottom: 12px;
        }

        .contact-card {
            display: flex;
            align-items: center;
            gap: 14px;
            padding: 12px;
            background: var(--bg-secondary);
            border-radius: 6px;
            margin-bottom: 8px;
        }

        .contact-card:last-child {
            margin-bottom: 0;
        }

        .contact-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--accent-blue);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 500;
            font-size: 14px;
            flex-shrink: 0;
        }

        .contact-info {
            flex: 1;
            min-width: 0;
        }

        .contact-name {
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 3px;
        }

        .contact-role {
            font-size: 12px;
            color: var(--text-secondary);
        }

        .contact-actions {
            display: flex;
            gap: 8px;
        }

        .contact-btn {
            width: 28px;
            height: 28px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            background: var(--bg-secondary);
            color: var(--text-secondary);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            position: relative;
        }

        .contact-btn:hover {
            border-color: var(--accent-cyan);
            color: var(--accent-cyan);
        }

        .contact-btn svg {
            width: 14px;
            height: 14px;
        }

        /* Contact Popover */
        .contact-popover {
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 4px;
            padding: 8px 12px;
            font-size: 12px;
            z-index: 100;
            box-shadow: var(--shadow);
            white-space: nowrap;
            margin-bottom: 8px;
        }

        .contact-popover::after {
            content: '';
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            border: 6px solid transparent;
            border-top-color: var(--border-color);
        }

        .contact-popover a {
            color: var(--accent-cyan);
            text-decoration: none;
        }

        .contact-popover a:hover {
            text-decoration: underline;
        }

        /* Property Address Link */
        .property-address-link {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
            color: inherit;
            cursor: pointer;
        }

        .property-address-link:hover .property-address {
            color: var(--accent-cyan);
        }

        .property-address-link .map-icon {
            width: 20px;
            height: 20px;
            color: var(--text-muted);
            transition: color 0.2s;
        }

        .property-address-link:hover .map-icon {
            color: var(--accent-cyan);
        }

        /* Header Stats */
        .header-stats {
            display: flex;
            gap: 24px;
        }

        .stat-item {
            text-align: center;
        }

        .stat-value {
            display: block;
            font-size: 20px;
            font-weight: 600;
            font-family: 'Roboto Mono', monospace;
            color: var(--text-primary);
        }

        .stat-label {
            font-size: 10px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--text-secondary);
        }

        .stat-item.urgent .stat-value {
            color: var(--alert-red);
        }

        .stat-item.safe .stat-value {
            color: var(--success-green);
        }

        /* Credentials Popup */
        .credentials-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            z-index: 600;
            align-items: center;
            justify-content: center;
        }

        .credentials-overlay.open {
            display: flex;
        }

        .credentials-popup {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 24px;
            min-width: 340px;
            box-shadow: var(--shadow);
        }

        .credentials-popup-title {
            font-size: 16px;
            font-weight: 500;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .credential-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid var(--border-color);
        }

        .credential-row:last-of-type {
            border-bottom: none;
        }

        .credential-label {
            font-size: 12px;
            color: var(--text-secondary);
        }

        .credential-value {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .credential-text {
            font-family: 'Roboto Mono', monospace;
            font-size: 13px;
        }

        .copy-btn {
            background: var(--accent-blue);
            color: white;
            border: none;
            padding: 4px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 11px;
            transition: background 0.2s;
        }

        .copy-btn:hover {
            background: var(--accent-cyan);
        }

        .copy-btn.copied {
            background: var(--success-green);
        }

        .credentials-actions {
            display: flex;
            gap: 12px;
            margin-top: 20px;
        }

        .credentials-actions button {
            flex: 1;
            padding: 10px;
            border-radius: 6px;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-primary {
            background: var(--accent-blue);
            color: white;
            border: none;
        }

        .btn-primary:hover {
            background: var(--accent-cyan);
        }

        .btn-secondary {
            background: transparent;
            color: var(--text-secondary);
            border: 1px solid var(--border-color);
        }

        .btn-secondary:hover {
            border-color: var(--text-secondary);
            color: var(--text-primary);
        }

        /* Settings Modal */
        .settings-modal {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 24px;
            min-width: 380px;
        }

        .settings-title {
            font-size: 16px;
            font-weight: 500;
            margin-bottom: 8px;
        }

        .settings-subtitle {
            font-size: 12px;
            color: var(--text-secondary);
            margin-bottom: 20px;
        }

        .settings-field {
            margin-bottom: 16px;
        }

        .settings-field label {
            display: block;
            font-size: 12px;
            color: var(--text-secondary);
            margin-bottom: 6px;
        }

        .settings-field input {
            width: 100%;
            padding: 10px 12px;
            background: var(--bg-panel);
            border: 1px solid var(--border-color);
            border-radius: 4px;
            color: var(--text-primary);
            font-size: 14px;
        }

        .settings-field input:focus {
            outline: none;
            border-color: var(--accent-cyan);
        }

        /* Settings gear button */
        .settings-btn {
            width: 32px;
            height: 32px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            background: var(--bg-panel);
            color: var(--text-secondary);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .settings-btn:hover {
            border-color: var(--accent-cyan);
            color: var(--accent-cyan);
        }

        /* Task with external link */
        .task-link-btn {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            font-size: 10px;
            padding: 3px 8px;
            border-radius: 3px;
            background: rgba(0, 82, 136, 0.2);
            color: var(--accent-blue);
            text-decoration: none;
            cursor: pointer;
            border: none;
            transition: all 0.2s;
        }

        .task-link-btn:hover {
            background: rgba(0, 82, 136, 0.3);
        }

        .task-link-btn svg {
            width: 12px;
            height: 12px;
        }

        /* ========================================
           Data Mode Toggle
           ======================================== */
        .data-mode-toggle {
            position: fixed;
            bottom: 20px;
            right: 20px;
            display: flex;
            align-items: center;
            gap: 8px;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            padding: 8px 12px;
            font-size: 12px;
            color: var(--text-secondary);
        }

        .toggle-switch {
            width: 40px;
            height: 20px;
            background: var(--bg-panel);
            border-radius: 10px;
            position: relative;
            cursor: pointer;
        }

        .toggle-switch.active {
            background: var(--accent-cyan);
        }

        .toggle-switch::after {
            content: '';
            position: absolute;
            width: 16px;
            height: 16px;
            background: white;
            border-radius: 50%;
            top: 2px;
            left: 2px;
            transition: left 0.2s ease;
        }

        .toggle-switch.active::after {
            left: 22px;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="logo-section">
            <div class="logo">
                <div class="logo-icon">M</div>
                <div class="logo-text">MUCE <span>Deal Oversight</span></div>
            </div>

            <div class="property-selector-row">
                <div class="property-dropdown" id="propertyDropdown">
                    <div class="property-dropdown-btn" onclick="togglePropertyDropdown()">
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <span class="urgency-dot" id="currentUrgencyDot"></span>
                            <span id="currentPropertyName">4891 NE 147th Court, Williston, FL 32696</span>
                        </div>
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="6 9 12 15 18 9"></polyline>
                        </svg>
                    </div>
                    <div class="property-dropdown-content" id="propertyDropdownContent">
                        <!-- Populated by JavaScript -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Header Stats -->
        <div class="header-stats">
            <div class="stat-item" id="statDueToday">
                <span class="stat-value">0</span>
                <span class="stat-label">Due Today</span>
            </div>
            <div class="stat-item urgent" id="statOverdue">
                <span class="stat-value">0</span>
                <span class="stat-label">Overdue</span>
            </div>
            <div class="stat-item safe" id="statComplete">
                <span class="stat-value">0%</span>
                <span class="stat-label">Complete</span>
            </div>
            <button class="settings-btn" onclick="openSettingsModal()" title="Settings">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="3"></circle>
                    <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
                </svg>
            </button>
        </div>

        <div class="countdown-container">
            <div class="countdown-box urgent" id="countdownBox">
                <div class="countdown-days" id="countdownDays">19</div>
                <div class="countdown-label">Days to Auction</div>
                <div class="countdown-status unpaid" id="countdownStatus">TAX DEED UNPAID</div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <div class="main-container">
        <!-- Details Panel -->
        <div class="details-panel">
            <div class="property-header">
                <div class="property-address-row">
                    <h1 class="property-address" id="propertyAddress">4891 NE 147th Court</h1>
                    <button class="header-icon-btn small" onclick="openGoogleMaps(event)" title="Open in Google Maps">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                            <circle cx="12" cy="10" r="3"></circle>
                        </svg>
                    </button>
                </div>
                <p class="property-location">
                    <span id="propertyLocation">Williston, FL 32696</span> &bull;
                    <span class="county-link" onclick="openCountyPanel()" id="countyName">Levy County</span>
                </p>
            </div>

            <div class="info-grid">
                <!-- Property Info (Address + Seller/Buyer) -->
                <div class="info-card">
                    <div class="info-card-title">Property Info</div>
                    <div class="info-row">
                        <span class="info-label">Seller</span>
                        <span class="info-value" id="sellerName">Marcos Luis Garcia</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Buyer</span>
                        <span class="info-value" id="buyerName">4891 NE 147th Court Land Trust</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Accepted On</span>
                        <span class="info-value" id="acceptedDate">Jan 22, 2026</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Closes On</span>
                        <span class="info-value" id="closesDate">Feb 13, 2026</span>
                    </div>
                </div>

                <!-- Deal Details -->
                <div class="info-card">
                    <div class="info-card-title">Deal Details</div>
                    <div class="info-row">
                        <span class="info-label">Status</span>
                        <span class="info-value">Accepted Contract</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Option</span>
                        <span class="info-value highlight" id="optionType">Save & Stay</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Auction</span>
                        <span class="info-value"><span id="auctionDate">Feb 9, 2026</span> (<span id="auctionType">Tax Deed</span>)</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Lien Amount</span>
                        <span class="info-value amount" id="lienAmount">$10,946.16</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Mortgage</span>
                        <span class="status-badge no" id="hasMortgage">No</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">HOA</span>
                        <span class="status-badge no" id="hasHOA">No</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Probate</span>
                        <span class="status-badge no" id="isProbate">No</span>
                    </div>
                </div>

                <!-- All Contacts Combined -->
                <div class="info-card" id="contactsCard">
                    <div class="info-card-title">Contacts</div>

                    <!-- Title Company Section -->
                    <div class="contact-section" id="titleCompanySection">
                        <div class="contact-section-header">Title Company (<span id="titleOptionLabel">Option 1</span>)</div>
                        <div class="contact-card" id="titleCompanyContact">
                            <div class="contact-avatar">CL</div>
                            <div class="contact-info">
                                <div class="contact-name" id="titleContactName">Cathy L Morrison</div>
                                <div class="contact-role" id="titleCompanyName">IPC</div>
                            </div>
                            <div class="contact-actions">
                                <button class="contact-btn" onclick="showContactPopover(this, 'phone', '863-732-8485')" title="Show phone">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path></svg>
                                </button>
                                <button class="contact-btn" onclick="showContactPopover(this, 'email', 'Cathy@ipcpolk.com')" title="Show email">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path><polyline points="22,6 12,13 2,6"></polyline></svg>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- MUCE Team Section -->
                    <div class="contact-section">
                        <div class="contact-section-header">MUCE Team</div>
                        <div class="contact-card">
                            <div class="contact-avatar" style="background: #7b2cbf;">GC</div>
                            <div class="contact-info">
                                <div class="contact-name">Gabe Clements</div>
                                <div class="contact-role">Oversight</div>
                            </div>
                            <div class="contact-actions">
                                <button class="contact-btn" onclick="showContactPopover(this, 'phone', '561-704-6598')" title="Show phone">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path></svg>
                                </button>
                                <button class="contact-btn" onclick="showContactPopover(this, 'email', 'gabeclements@gmail.com')" title="Show email">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path><polyline points="22,6 12,13 2,6"></polyline></svg>
                                </button>
                            </div>
                        </div>
                        <div class="contact-card">
                            <div class="contact-avatar" style="background: #e91e63;">MB</div>
                            <div class="contact-info">
                                <div class="contact-name">Marcy Buras</div>
                                <div class="contact-role">Coordinator</div>
                            </div>
                            <div class="contact-actions">
                                <button class="contact-btn" onclick="showContactPopover(this, 'email', 'marcyburas@gmail.com')" title="Show email">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path><polyline points="22,6 12,13 2,6"></polyline></svg>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Specialists Section -->
                    <div class="contact-section">
                        <div class="contact-section-header">Specialists</div>
                        <div class="contact-card">
                            <div class="contact-avatar" style="background: var(--accent-cyan);">BJ</div>
                            <div class="contact-info">
                                <div class="contact-name">Bernadine Jones</div>
                                <div class="contact-role">Transaction Coordinator (C2C)</div>
                            </div>
                            <div class="contact-actions">
                                <button class="contact-btn" onclick="showContactPopover(this, 'phone', '954-309-0270')" title="Show phone">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path></svg>
                                </button>
                                <button class="contact-btn" onclick="showContactPopover(this, 'email', 'bernadine@contracttoclosesolutions.com')" title="Show email">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path><polyline points="22,6 12,13 2,6"></polyline></svg>
                                </button>
                            </div>
                        </div>
                        <div class="contact-card">
                            <div class="contact-avatar" style="background: #ff9800;">CP</div>
                            <div class="contact-info">
                                <div class="contact-name">Colleen Pacheco</div>
                                <div class="contact-role">Insurance</div>
                            </div>
                            <div class="contact-actions">
                                <button class="contact-btn" onclick="showContactPopover(this, 'phone', '407-559-2200')" title="Show phone">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path></svg>
                                </button>
                                <button class="contact-btn" onclick="showContactPopover(this, 'email', 'colleen@securedinsurancegrp.com')" title="Show email">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path><polyline points="22,6 12,13 2,6"></polyline></svg>
                                </button>
                            </div>
                        </div>
                        <div class="contact-card" id="probateAttorneyCard">
                            <div class="contact-avatar" style="background: #673ab7;">RK</div>
                            <div class="contact-info">
                                <div class="contact-name">Riley Kendall</div>
                                <div class="contact-role">Probate Attorney</div>
                            </div>
                            <div class="contact-actions">
                                <button class="contact-btn" onclick="showContactPopover(this, 'phone', '407-674-0104')" title="Show phone">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path></svg>
                                </button>
                                <button class="contact-btn" onclick="showContactPopover(this, 'email', 'rkendall@meltonfirm.com')" title="Show email">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path><polyline points="22,6 12,13 2,6"></polyline></svg>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Checklist Panel (MAIN) -->
        <div class="checklist-panel">
            <div class="checklist-header">
                <div class="checklist-title">
                    <h2>Checklist</h2>
                    <span class="completion-badge" id="completionBadge">37%</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill" style="width: 37%"></div>
                </div>
            </div>

            <!-- Sections will be populated by JavaScript -->
            <div id="checklistSections"></div>
        </div>
    </div>

    <!-- Data Mode Toggle -->
    <div class="data-mode-toggle">
        <span>Demo Mode</span>
        <div class="toggle-switch" id="dataToggle" onclick="toggleDataMode()"></div>
        <span>Live</span>
    </div>

    <!-- County Links Slide-out Panel -->
    <div class="county-panel-overlay" id="countyPanelOverlay" onclick="closeCountyPanel(event)">
        <div class="county-panel" onclick="event.stopPropagation()">
            <div class="county-panel-header">
                <span class="county-panel-title" id="countyPanelTitle">Levy County Links</span>
                <button class="county-panel-close" onclick="closeCountyPanel()">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>
            <div class="county-panel-content" id="countyPanelContent">
                <!-- County links populated by JavaScript -->
            </div>
        </div>
    </div>

    <!-- Simplifile Credentials Popup -->
    <div class="credentials-overlay" id="credentialsOverlay" onclick="closeCredentialsPopup(event)">
        <div class="credentials-popup" onclick="event.stopPropagation()">
            <div class="credentials-popup-title">
                <span>Simplifile Login</span>
                <button class="county-panel-close" onclick="closeCredentialsPopup()">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>
            <div class="credential-row">
                <span class="credential-label">Username</span>
                <div class="credential-value">
                    <span class="credential-text" id="simplifileUsername">Not set</span>
                    <button class="copy-btn" onclick="copyCredential('simplifileUsername')">Copy</button>
                </div>
            </div>
            <div class="credential-row">
                <span class="credential-label">Password</span>
                <div class="credential-value">
                    <span class="credential-text" id="simplifilePassword"></span>
                    <button class="copy-btn" onclick="copyCredential('simplifilePassword')">Copy</button>
                </div>
            </div>
            <div class="credentials-actions">
                <button class="btn-secondary" onclick="openSettingsModal()">Settings</button>
                <a href="https://simplifile.com/sf/ui/login" target="_blank" class="btn-primary" style="text-decoration: none; text-align: center;">Open Simplifile</a>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div class="credentials-overlay" id="settingsOverlay" onclick="closeSettingsModal(event)">
        <div class="settings-modal" onclick="event.stopPropagation()">
            <div class="settings-title">Service Credentials</div>
            <div class="settings-subtitle">Stored locally in your browser only. Never synced or uploaded.</div>

            <div style="border-bottom: 1px solid var(--border-color); margin-bottom: 16px; padding-bottom: 16px;">
                <div style="font-size: 12px; font-weight: 500; margin-bottom: 12px; color: var(--text-secondary);">SIMPLIFILE</div>
                <div class="settings-field">
                    <label>Username</label>
                    <input type="text" id="settingsSimplifileUsername" placeholder="Enter Simplifile username">
                </div>
                <div class="settings-field">
                    <label>Password</label>
                    <input type="password" id="settingsSimplifilePassword" placeholder="Enter Simplifile password">
                </div>
            </div>

            <div class="credentials-actions">
                <button class="btn-secondary" onclick="closeSettingsModal()">Cancel</button>
                <button class="btn-primary" onclick="saveSettings()">Save</button>
            </div>
        </div>
    </div>

    <script>
        // ========================================
        // Demo Property Data
        // ========================================
        const DEMO_PROPERTIES = {
            demo1: {
                address: '4891 NE 147th Court',
                city: 'Williston',
                state: 'FL',
                zip: '32696',
                county: 'Levy',
                auctionDate: '2026-02-09',
                auctionType: 'tax_deed',
                optionType: 'option_1',
                lienAmount: 10946.16,
                seller: 'Marcos Luis Garcia',
                buyer: '4891 NE 147th Court Land Trust',
                hasMortgage: false,
                hasHOA: false,
                isProbate: false,
                acceptedDate: '2026-01-22',
                closesDate: '2026-02-13',
                lienPaid: false
            },
            sawgrass: {
                address: '3502 SW Sawgrass Villas Drive',
                city: 'Palm City',
                state: 'FL',
                zip: '34990',
                county: 'Martin',
                auctionDate: '2026-01-27',
                auctionType: 'hoa_foreclosure',
                optionType: 'option_1',
                lienAmount: 14931.76,
                seller: 'Sarah Garritano',
                buyer: '3502 SW Sawgrass Villas Drive Land Trust',
                hasMortgage: false,
                hasHOA: true,
                isProbate: false,
                acceptedDate: '2026-01-22',
                closesDate: '2026-02-03',
                lienPaid: true
            },
            norfolk: {
                address: '3136 Norfolk Street',
                city: 'Mims',
                state: 'FL',
                zip: '32754',
                county: 'Brevard',
                auctionDate: '2026-02-19',
                auctionType: 'tax_deed',
                optionType: 'option_1',
                lienAmount: 6697.61,
                seller: 'Thunder Stormcloud and Cynthia Stormcloud',
                buyer: '3136 Norfolk St Land Trust',
                hasMortgage: false,
                hasHOA: false,
                isProbate: false,
                acceptedDate: '2026-01-13',
                closesDate: '2026-01-22',
                lienPaid: true
            },
            homestead: {
                address: '2735 SE 16th Ave Unit 102',
                city: 'Homestead',
                state: 'FL',
                zip: '33035',
                county: 'Miami-Dade',
                auctionDate: '2026-01-15',
                auctionType: 'tax_deed',
                optionType: 'option_1',
                lienAmount: 8635.87,
                seller: 'Kenneth Bryant and Concetta Gaffney',
                buyer: '2735 SE 16th Ave Unit 102 Land Trust',
                hasMortgage: false,
                hasHOA: true,
                isProbate: false,
                acceptedDate: '2026-01-08',
                closesDate: '2026-01-23',
                lienPaid: true
            },
            walsh: {
                address: '375 Walsh Circle',
                city: 'Lehigh Acres',
                state: 'FL',
                zip: '33972',
                county: 'Lee',
                auctionDate: '2026-03-01',
                auctionType: 'tax_deed',
                optionType: 'option_1',
                lienAmount: 0,
                seller: 'TBD',
                buyer: '375 Walsh Circle Land Trust',
                hasMortgage: false,
                hasHOA: false,
                isProbate: false,
                acceptedDate: '2026-01-25',
                closesDate: '2026-02-25',
                lienPaid: false
            }
        };

        // ========================================
        // Checklist Template Data (Workflow Order)
        // ========================================
        const CHECKLIST_SECTIONS = [
            // 1. Executed Docs - First (renamed from Documents Required)
            {
                id: 'executed_docs',
                name: 'Executed Docs',
                description: 'Document collection',
                isDocSection: true,
                tasks: [
                    { id: 'd1', name: 'PSA (Purchase and Sale Agreement)', dueOffset: -30, allowNA: true },
                    { id: 'd2', name: 'Quitclaim Deed(s)', dueOffset: -25, allowNA: true },
                    { id: 'd3', name: 'Lease Agreement', dueOffset: -20, allowNA: true },
                    { id: 'd4', name: 'Land Trust', dueOffset: -20, allowNA: true },
                    { id: 'd5', name: '3rd Party Authorization', dueOffset: -25, allowNA: true },
                    { id: 'd6', name: 'Most recent mortgage statement', dueOffset: -25, allowNA: true },
                    { id: 'd7', name: 'Note & Mortgage', dueOffset: -10, allowNA: true },
                    { id: 'd8', name: 'Insurance Binder', dueOffset: -7, allowNA: true },
                    { id: 'd9', name: 'HUD Statement', dueOffset: -3, allowNA: true },
                    { id: 'd10', name: 'Closing Package', dueOffset: -1, allowNA: true }
                ]
            },
            // 2. Timing-Dependent Tasks - 14-day rule
            {
                id: 'timing_dependent',
                name: 'Timing-Dependent Tasks',
                description: '14-day rule applies',
                isTimingSection: true,
                tasks: [
                    { id: 't1', name: 'Recording Deed', timingDependent: true, dueOffset: -7, hasServiceLink: true, serviceType: 'simplifile' },
                    { id: 't2', name: 'Preliminary Lien Search', timingDependent: true, dueOffset: -14 },
                    { id: 't3', name: 'Call County Tax Collector', timingDependent: true, dueOffset: -21, subtasks: [
                        'Determine if Tax Deed exists',
                        'Get amount and "good through" date',
                        'Get total tax owed',
                        'Get wire/payment instructions'
                    ]},
                    { id: 't4', name: 'Call Courthouse (if lien exists)', timingDependent: true, dueOffset: -14 },
                    { id: 't5', name: 'Mortgage Reinstatement (if applicable)', timingDependent: true, dueOffset: -14 },
                    { id: 't6', name: 'Confirm Auction Cancellation', timingDependent: true, dueOffset: -3 }
                ]
            },
            // 3. C2C Standard Tasks
            {
                id: 'c2c_standard',
                name: 'C2C Standard Tasks',
                description: 'Every transaction',
                tasks: [
                    { id: 'c1', name: 'Open File & Order Title/Lien Search', dueOffset: -30, hasEmailLink: true, emailType: 'title' },
                    { id: 'c3', name: 'Insurance Quote Initial Request', dueOffset: -25, hasEmailLink: true, emailType: 'insurance' },
                    { id: 'c4', name: 'Receive MUCE funding approval notification', dueOffset: -14 },
                    { id: 'c5', name: 'Notify Colleen to bind insurance', dueOffset: -7 },
                    { id: 'c6', name: 'Receive recorded Note and Mortgage', dueOffset: -5 },
                    { id: 'c7', name: 'Receive finalized Land Trust from MUCE', dueOffset: -3 },
                    { id: 'c8', name: 'Follow up on Title Search', dueOffset: -21 },
                    { id: 'c9', name: 'Follow up on Lien Search', dueOffset: -21 },
                    { id: 'c10', name: 'Confirm good to order inspection', dueOffset: -20 },
                    { id: 'c11', name: 'Order inspection once lien search back', dueOffset: -18 },
                    { id: 'c12', name: 'Follow up on insurance policy', dueOffset: -14 },
                    { id: 'c13', name: 'Schedule closing', dueOffset: -10 }
                ]
            },
            // 4. Tax/County Coordination
            {
                id: 'tax_county',
                name: 'Tax/County Coordination',
                description: 'Tax deed process',
                tasks: [
                    { id: 'x1', name: 'Call County Tax Collector for payoff', dueOffset: -21 },
                    { id: 'x2', name: 'Request county email with amount & wire instructions', dueOffset: -18 },
                    { id: 'x3', name: 'Forward county email to Marcy', dueOffset: -17 },
                    { id: 'x4', name: 'Collect receipt/proof of payment', dueOffset: -7 },
                    { id: 'x5', name: 'File receipt/proof of payment', dueOffset: -5 }
                ]
            },
            // 5. Lender & HOA Management
            {
                id: 'lender_hoa',
                name: 'Lender & HOA Management',
                description: 'Contact coordination',
                tasks: [
                    { id: 'l1', name: 'Get Lender contact info from Marcy', dueOffset: -25 },
                    { id: 'l2', name: 'Get HOA contact info from Marcy', dueOffset: -25 },
                    { id: 'l3', name: 'Contact Lender for payment instructions', dueOffset: -21 },
                    { id: 'l4', name: 'Contact HOA for payment instructions', dueOffset: -21 },
                    { id: 'l5', name: 'Set up ACH payments if possible', dueOffset: -14 },
                    { id: 'l6', name: 'Confirm payment method with lender/HOA', dueOffset: -7 }
                ]
            },
            // 6. Option 2 - Utilities (conditional)
            {
                id: 'option2_utilities',
                name: 'Option 2 - Utilities',
                description: 'Save & Sell only',
                optionFilter: 'option_2',
                tasks: [
                    { id: 'u1', name: 'Change Electric into MUCE name', dueOffset: -10 },
                    { id: 'u2', name: 'Change Water into MUCE name', dueOffset: -10 },
                    { id: 'u3', name: 'Set up trash removal', dueOffset: -10 },
                    { id: 'u4', name: 'Set autopay on utilities', dueOffset: -7 },
                    { id: 'u5', name: 'Confirm trash pickup days & bulk process', dueOffset: -5 }
                ]
            }
        ];

        // County links data (from Excel file)
        const COUNTY_LINKS = {
            'Levy': {
                foreclosure: 'https://www.levyclerk.com/index.php/foreclosure-sales/',
                taxDeed: 'https://www.levyclerk.com/index.php/tax-deed-sales/',
                caseLookup: 'https://www.levyclerk.com/index.php/court-records/',
                appraiser: 'https://www.levypa.com/',
                taxCollector: 'https://www.levytaxcollector.com/',
                officialRecords: 'https://www.levyclerk.com/index.php/official-records/'
            },
            'Pinellas': {
                foreclosure: 'https://www.pinellasclerk.org/aspInclude2/ASPInclude.asp?pageName=foreclosure.htm',
                taxDeed: 'https://www.pinellasclerk.org/aspInclude2/ASPInclude.asp?pageName=taxdeed.htm',
                caseLookup: 'https://www.pinellasclerk.org/aspInclude2/ASPInclude.asp?pageName=courtRecords.htm',
                appraiser: 'https://www.pcpao.org/',
                taxCollector: 'https://www.taxcollect.com/',
                officialRecords: 'https://www.pinellasclerk.org/aspInclude2/ASPInclude.asp?pageName=officialRecords.htm'
            }
            // More counties will be loaded from the full Excel data
        };

        // Title company emails
        const TITLE_COMPANIES = {
            option_1: {
                name: 'IPC',
                email: 'Cathy@ipcpolk.com',
                contact: 'Cathy L Morrison'
            },
            option_2: {
                name: 'University Title',
                email: 'mdubbs@u-titleagency.com',
                contact: 'Meaghan Dubbs'
            }
        };

        const BERNADINE_EMAIL = 'bernadine@contracttoclosesolutions.com';
        const COLLEEN_EMAIL = 'colleen@securedinsurancegrp.com';

        // ========================================
        // State Management
        // ========================================
        let currentProperty = 'demo1';
        let checklistState = {};  // { propertyId: { sectionId: { taskId: true/false } } }
        let naState = {};         // { propertyId: { taskId: true/false } }
        let isLiveMode = false;

        // ========================================
        // Initialization
        // ========================================
        function init() {
            loadChecklistState();
            renderPropertyDropdown();
            renderChecklist();
            loadProperty(currentProperty);
            updateCountdown();
            setInterval(updateCountdown, 60000); // Update every minute

            // Close dropdown on outside click
            document.addEventListener('click', (e) => {
                if (!e.target.closest('.property-dropdown')) {
                    document.getElementById('propertyDropdown').classList.remove('open');
                }
            });
        }

        function loadChecklistState() {
            const saved = localStorage.getItem('dealOversightChecklist');
            if (saved) {
                checklistState = JSON.parse(saved);
            }
            const savedNA = localStorage.getItem('dealOversightNA');
            if (savedNA) {
                naState = JSON.parse(savedNA);
            }
        }

        function saveChecklistState() {
            localStorage.setItem('dealOversightChecklist', JSON.stringify(checklistState));
            localStorage.setItem('dealOversightNA', JSON.stringify(naState));
        }

        // ========================================
        // Property Dropdown
        // ========================================
        function togglePropertyDropdown() {
            document.getElementById('propertyDropdown').classList.toggle('open');
        }

        function renderPropertyDropdown() {
            const content = document.getElementById('propertyDropdownContent');
            let html = '';

            Object.entries(DEMO_PROPERTIES).forEach(([id, prop]) => {
                const urgencyClass = getUrgencyClass(prop.auctionDate);
                const isSelected = id === currentProperty;

                html += `
                    <div class="property-option ${isSelected ? 'selected' : ''}" onclick="selectProperty('${id}')">
                        <span class="urgency-dot ${urgencyClass}"></span>
                        <span>${prop.address}, ${prop.city}, ${prop.state} ${prop.zip}</span>
                    </div>
                `;
            });

            content.innerHTML = html;
        }

        function selectProperty(propertyId) {
            document.getElementById('propertyDropdown').classList.remove('open');
            loadProperty(propertyId);
            renderPropertyDropdown();
        }

        function getUrgencyClass(auctionDateStr) {
            const auctionDate = new Date(auctionDateStr);
            const today = new Date();
            const daysUntil = Math.ceil((auctionDate - today) / (1000 * 60 * 60 * 24));

            if (daysUntil <= 6) return 'danger';
            if (daysUntil <= 13) return 'warning';
            if (daysUntil <= 29) return 'caution';
            return 'safe';
        }

        function updatePropertyDropdownButton() {
            const property = DEMO_PROPERTIES[currentProperty];
            const urgencyClass = getUrgencyClass(property.auctionDate);

            document.getElementById('currentPropertyName').textContent =
                `${property.address}, ${property.city}, ${property.state} ${property.zip}`;
            document.getElementById('currentUrgencyDot').className = `urgency-dot ${urgencyClass}`;
        }

        // ========================================
        // Checklist Rendering
        // ========================================
        function renderChecklist() {
            const container = document.getElementById('checklistSections');
            const property = DEMO_PROPERTIES[currentProperty];

            // Calculate days to auction for ownership
            const auctionDate = new Date(property.auctionDate);
            const today = new Date();
            const daysUntilAuction = Math.ceil((auctionDate - today) / (1000 * 60 * 60 * 24));
            const timingOwner = daysUntilAuction < 14 ? 'MUCE' : 'C2C';

            let html = '';

            CHECKLIST_SECTIONS.forEach(section => {
                // Filter sections by option type
                if (section.optionFilter && section.optionFilter !== property.optionType) {
                    return;
                }

                const sectionState = checklistState[currentProperty]?.[section.id] || {};
                const propNAState = naState[currentProperty] || {};

                // Count completed (excluding N/A)
                const completedCount = section.tasks.filter(t => sectionState[t.id] && !propNAState[t.id]).length;
                const naCount = section.tasks.filter(t => propNAState[t.id]).length;
                const totalCount = section.tasks.length - naCount;
                const progressPercent = totalCount > 0 ? Math.round((completedCount / totalCount) * 100) : 100;

                // Section owner badge for timing-dependent section
                let ownerBadge = '';
                if (section.isTimingSection) {
                    ownerBadge = `<span class="section-owner-badge ${timingOwner.toLowerCase()}">${timingOwner} - ${daysUntilAuction} days</span>`;
                }

                html += `
                    <div class="section ${completedCount > 0 ? 'expanded' : ''}" data-section="${section.id}">
                        <div class="section-header" onclick="toggleSection('${section.id}')">
                            <div class="section-header-left">
                                <svg class="section-chevron" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="9 18 15 12 9 6"></polyline>
                                </svg>
                                <div>
                                    <div class="section-name">${section.name}${ownerBadge}</div>
                                    <div class="section-count">${completedCount} of ${totalCount}${naCount > 0 ? ` (${naCount} N/A)` : ''}</div>
                                </div>
                            </div>
                            ${renderProgressRing(progressPercent)}
                        </div>
                        <div class="section-content">
                            ${section.tasks.map(task => renderTask(section, task, property, sectionState[task.id], propNAState[task.id], daysUntilAuction)).join('')}
                        </div>
                    </div>
                `;
            });

            container.innerHTML = html;
            updateOverallProgress();
        }

        function renderProgressRing(percent) {
            const radius = 12;
            const circumference = 2 * Math.PI * radius;
            const offset = circumference - (percent / 100) * circumference;

            return `
                <svg class="section-progress-ring" viewBox="0 0 32 32">
                    <circle cx="16" cy="16" r="${radius}" fill="none" stroke="var(--bg-panel)" stroke-width="3"/>
                    <circle cx="16" cy="16" r="${radius}" fill="none" stroke="var(--success-green)" stroke-width="3"
                            stroke-dasharray="${circumference}" stroke-dashoffset="${offset}"
                            transform="rotate(-90 16 16)" style="transition: stroke-dashoffset 0.5s ease"/>
                </svg>
            `;
        }

        function renderTask(section, task, property, isCompleted, isNA, daysUntilAuction) {
            const sectionId = section.id;
            const auctionDate = new Date(property.auctionDate);
            const dueDate = new Date(auctionDate);
            dueDate.setDate(dueDate.getDate() + (task.dueOffset || 0));

            const today = new Date();
            const daysUntilDue = Math.ceil((dueDate - today) / (1000 * 60 * 60 * 24));

            // Determine owner based on 14-day rule
            let owner = 'C2C';
            if (task.timingDependent) {
                owner = daysUntilAuction < 14 ? 'MUCE' : 'C2C';
            }

            // Due date styling
            let dueClass = '';
            if (!isCompleted && !isNA) {
                if (daysUntilDue < 0) dueClass = 'overdue';
                else if (daysUntilDue <= 7) dueClass = 'warning';
            }

            const formattedDue = dueDate.toLocaleDateString('en-US', { month: 'numeric', day: 'numeric' });

            // Build class list
            let itemClasses = ['task-item'];
            if (isCompleted) itemClasses.push('completed');
            if (isNA) itemClasses.push('na-marked');
            if (section.isDocSection && isCompleted) itemClasses.push('doc-checked');
            if (task.timingDependent) itemClasses.push(`${owner.toLowerCase()}-owned`);

            // Gmail compose link
            let emailLinkHtml = '';
            if (task.hasEmailLink) {
                const gmailUrl = generateGmailLink(task.emailType, property);
                emailLinkHtml = `
                    <a href="${gmailUrl}" target="_blank" class="task-email-btn" onclick="event.stopPropagation()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path>
                            <polyline points="22,6 12,13 2,6"></polyline>
                        </svg>
                        Email
                    </a>
                `;
            }

            // Service link (e.g., Simplifile)
            let serviceLinkHtml = '';
            if (task.hasServiceLink && task.serviceType === 'simplifile') {
                serviceLinkHtml = `
                    <button class="task-link-btn" onclick="openSimplifileWithCredentials(event)">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path>
                            <polyline points="15 3 21 3 21 9"></polyline>
                            <line x1="10" y1="14" x2="21" y2="3"></line>
                        </svg>
                        Simplifile
                    </button>
                `;
            }

            // N/A toggle for documents
            let naToggleHtml = '';
            if (task.allowNA) {
                naToggleHtml = `
                    <span class="task-na-toggle ${isNA ? 'active' : ''}" onclick="toggleNA('${task.id}'); event.stopPropagation();">N/A</span>
                `;
            }

            return `
                <div class="${itemClasses.join(' ')}" data-task="${task.id}">
                    <div class="task-checkbox ${isCompleted ? 'checked' : ''}" onclick="toggleTask('${sectionId}', '${task.id}')">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
                            <polyline points="20 6 9 17 4 12"></polyline>
                        </svg>
                    </div>
                    <div class="task-content">
                        <div class="task-name">${task.name}</div>
                        <div class="task-meta">
                            <span class="task-due ${dueClass}">${formattedDue}</span>
                            ${task.timingDependent ? `<span class="task-owner ${owner.toLowerCase()}">${owner}</span>` : ''}
                            ${emailLinkHtml}
                            ${serviceLinkHtml}
                            ${naToggleHtml}
                        </div>
                    </div>
                </div>
            `;
        }

        // ========================================
        // Gmail Compose Links
        // ========================================
        function generateGmailLink(emailType, property) {
            const address = property.address;
            let to, cc, subject;

            if (emailType === 'title') {
                const titleCo = TITLE_COMPANIES[property.optionType];
                to = titleCo.email;
                cc = BERNADINE_EMAIL;
                subject = `(New File) Rush Order Title/Municipal ${address}`;
            } else if (emailType === 'insurance') {
                to = COLLEEN_EMAIL;
                cc = '';
                subject = `(New Quote Request) Insurance - ${address}`;
            }

            const params = new URLSearchParams({
                view: 'cm',
                to: to,
                su: subject
            });
            if (cc) params.append('cc', cc);

            return `https://mail.google.com/mail/?${params.toString()}`;
        }

        // ========================================
        // N/A Toggle
        // ========================================
        function toggleNA(taskId) {
            if (!naState[currentProperty]) {
                naState[currentProperty] = {};
            }

            naState[currentProperty][taskId] = !naState[currentProperty][taskId];
            saveChecklistState();
            renderChecklist();
        }

        // ========================================
        // Interactions
        // ========================================
        function toggleSection(sectionId) {
            const section = document.querySelector(`[data-section="${sectionId}"]`);
            section.classList.toggle('expanded');
        }

        function toggleTask(sectionId, taskId) {
            if (!checklistState[currentProperty]) {
                checklistState[currentProperty] = {};
            }
            if (!checklistState[currentProperty][sectionId]) {
                checklistState[currentProperty][sectionId] = {};
            }

            checklistState[currentProperty][sectionId][taskId] = !checklistState[currentProperty][sectionId][taskId];
            saveChecklistState();

            // Update UI
            const taskElement = document.querySelector(`[data-task="${taskId}"]`);
            const checkbox = taskElement.querySelector('.task-checkbox');

            if (checklistState[currentProperty][sectionId][taskId]) {
                taskElement.classList.add('completed');
                checkbox.classList.add('checked');
            } else {
                taskElement.classList.remove('completed');
                checkbox.classList.remove('checked');
            }

            // Update section progress
            updateSectionProgress(sectionId);
            updateOverallProgress();

            // Check if lien task completed (affects countdown)
            if (taskId === 'x4' || taskId === 't3') {
                updateCountdown();
            }

            // Re-render for doc section green styling
            const section = CHECKLIST_SECTIONS.find(s => s.id === sectionId);
            if (section?.isDocSection) {
                renderChecklist();
            }
        }

        function updateSectionProgress(sectionId) {
            const section = CHECKLIST_SECTIONS.find(s => s.id === sectionId);
            const sectionState = checklistState[currentProperty]?.[sectionId] || {};
            const completedCount = section.tasks.filter(t => sectionState[t.id]).length;
            const totalCount = section.tasks.length;

            const sectionEl = document.querySelector(`[data-section="${sectionId}"]`);
            sectionEl.querySelector('.section-count').textContent = `${completedCount} of ${totalCount}`;

            // Update progress ring
            const progressPercent = Math.round((completedCount / totalCount) * 100);
            const radius = 12;
            const circumference = 2 * Math.PI * radius;
            const offset = circumference - (progressPercent / 100) * circumference;
            const circle = sectionEl.querySelectorAll('circle')[1];
            if (circle) {
                circle.setAttribute('stroke-dashoffset', offset);
            }
        }

        function updateOverallProgress() {
            const property = DEMO_PROPERTIES[currentProperty];
            const propNAState = naState[currentProperty] || {};
            let totalTasks = 0;
            let completedTasks = 0;

            CHECKLIST_SECTIONS.forEach(section => {
                if (section.optionFilter && section.optionFilter !== property.optionType) {
                    return;
                }

                const sectionState = checklistState[currentProperty]?.[section.id] || {};

                section.tasks.forEach(task => {
                    // Skip N/A tasks from both total and completed
                    if (propNAState[task.id]) return;

                    totalTasks++;
                    if (sectionState[task.id]) completedTasks++;
                });
            });

            const percent = totalTasks > 0 ? Math.round((completedTasks / totalTasks) * 100) : 0;
            document.getElementById('completionBadge').textContent = `${percent}%`;
            document.getElementById('progressFill').style.width = `${percent}%`;
        }

        // ========================================
        // County Panel
        // ========================================
        function openCountyPanel() {
            const property = DEMO_PROPERTIES[currentProperty];
            const countyLinks = COUNTY_LINKS[property.county] || {};

            document.getElementById('countyPanelTitle').textContent = `${property.county} County Links`;

            const linkTypes = [
                { key: 'foreclosure', name: 'Foreclosure Auction', desc: 'View foreclosure sale listings', icon: 'gavel' },
                { key: 'taxDeed', name: 'Tax Deed Auction', desc: 'View tax deed sale listings', icon: 'document' },
                { key: 'caseLookup', name: 'Case Lookup', desc: 'Search court case records', icon: 'search' },
                { key: 'appraiser', name: 'Property Appraiser', desc: 'Property assessment records', icon: 'home' },
                { key: 'taxCollector', name: 'Tax Collector', desc: 'Property tax information', icon: 'dollar' },
                { key: 'officialRecords', name: 'Official Records', desc: 'Recorded documents search', icon: 'file' }
            ];

            const iconSVGs = {
                gavel: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14.5 2L17 4.5M2 21.5L10 13.5M10.5 10L18.5 2L21.5 5L13.5 13L10.5 10Z"/><path d="M2 21.5L9 14.5"/></svg>',
                document: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline></svg>',
                search: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>',
                home: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg>',
                dollar: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="1" x2="12" y2="23"></line><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path></svg>',
                file: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline></svg>'
            };

            let html = '';
            linkTypes.forEach(lt => {
                const url = countyLinks[lt.key];
                if (url) {
                    html += `
                        <a href="${url}" target="_blank" class="county-link-item">
                            <div class="county-link-icon">${iconSVGs[lt.icon]}</div>
                            <div class="county-link-text">
                                <div class="county-link-name">${lt.name}</div>
                                <div class="county-link-desc">${lt.desc}</div>
                            </div>
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="color: var(--text-muted)">
                                <line x1="7" y1="17" x2="17" y2="7"></line>
                                <polyline points="7 7 17 7 17 17"></polyline>
                            </svg>
                        </a>
                    `;
                } else {
                    html += `
                        <div class="county-link-item" style="opacity: 0.4; cursor: not-allowed;">
                            <div class="county-link-icon" style="background: var(--text-muted);">${iconSVGs[lt.icon]}</div>
                            <div class="county-link-text">
                                <div class="county-link-name">${lt.name}</div>
                                <div class="county-link-desc">Link not available</div>
                            </div>
                        </div>
                    `;
                }
            });

            document.getElementById('countyPanelContent').innerHTML = html;
            document.getElementById('countyPanelOverlay').classList.add('open');
        }

        function closeCountyPanel(event) {
            if (!event || event.target === document.getElementById('countyPanelOverlay')) {
                document.getElementById('countyPanelOverlay').classList.remove('open');
            }
        }

        // ========================================
        // Property Loading
        // ========================================
        function loadProperty(propertyId) {
            currentProperty = propertyId;
            const property = DEMO_PROPERTIES[propertyId];

            // Update header dropdown button
            updatePropertyDropdownButton();

            // Update property details
            document.getElementById('propertyAddress').textContent = property.address;
            document.getElementById('propertyLocation').textContent =
                `${property.city}, ${property.state} ${property.zip}`;
            document.getElementById('countyName').textContent = `${property.county} County`;

            // Update info cards
            document.getElementById('optionType').textContent =
                property.optionType === 'option_1' ? 'Save & Stay' : 'Save & Sell';
            document.getElementById('auctionDate').textContent =
                new Date(property.auctionDate).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
            const auctionTypeLabels = {
                'tax_deed': 'Tax Deed',
                'foreclosure': 'Foreclosure',
                'hoa_foreclosure': 'HOA Foreclosure'
            };
            document.getElementById('auctionType').textContent =
                auctionTypeLabels[property.auctionType] || property.auctionType;
            document.getElementById('lienAmount').textContent =
                '$' + property.lienAmount.toLocaleString('en-US', { minimumFractionDigits: 2 });

            document.getElementById('hasMortgage').textContent = property.hasMortgage ? 'Yes' : 'No';
            document.getElementById('hasMortgage').className = 'status-badge ' + (property.hasMortgage ? 'yes' : 'no');
            document.getElementById('hasHOA').textContent = property.hasHOA ? 'Yes' : 'No';
            document.getElementById('hasHOA').className = 'status-badge ' + (property.hasHOA ? 'yes' : 'no');
            document.getElementById('isProbate').textContent = property.isProbate ? 'Yes' : 'No';
            document.getElementById('isProbate').className = 'status-badge ' + (property.isProbate ? 'yes' : 'no');

            document.getElementById('sellerName').textContent = property.seller;
            document.getElementById('buyerName').textContent = property.buyer;

            // Update title company section
            const titleSection = document.getElementById('titleCompanySection');
            if (titleSection) {
                const titleContact = titleSection.querySelector('.contact-card');
                if (property.optionType === 'option_1') {
                    document.getElementById('titleOptionLabel').textContent = 'Option 1';
                    titleContact.querySelector('.contact-name').textContent = 'Cathy L Morrison';
                    titleContact.querySelector('.contact-role').textContent = 'IPC';
                } else {
                    document.getElementById('titleOptionLabel').textContent = 'Option 2';
                    titleContact.querySelector('.contact-name').textContent = 'Meaghan Dubbs';
                    titleContact.querySelector('.contact-role').textContent = 'University Title';
                }
            }

            // Re-render checklist for new property
            renderChecklist();
            updateCountdown();
        }

        // ========================================
        // Countdown
        // ========================================
        function updateCountdown() {
            const property = DEMO_PROPERTIES[currentProperty];
            const auctionDate = new Date(property.auctionDate);
            const today = new Date();
            const daysUntil = Math.ceil((auctionDate - today) / (1000 * 60 * 60 * 24));

            document.getElementById('countdownDays').textContent = daysUntil;

            // Check if lien is paid (check tax_county section for x4 task or timing_dependent for t3)
            const taxPaid = checklistState[currentProperty]?.tax_county?.x4 ||
                           checklistState[currentProperty]?.timing_dependent?.t3;

            const countdownBox = document.getElementById('countdownBox');
            const countdownStatus = document.getElementById('countdownStatus');

            if (taxPaid || property.lienPaid) {
                countdownBox.classList.remove('urgent');
                countdownBox.classList.add('resolved');
                countdownStatus.className = 'countdown-status paid';
                countdownStatus.textContent = '\u2713 LIEN RESOLVED';
            } else {
                countdownBox.classList.add('urgent');
                countdownBox.classList.remove('resolved');
                countdownStatus.className = 'countdown-status unpaid';
                countdownStatus.textContent = property.auctionType === 'tax_deed' ? 'TAX DEED UNPAID' : 'LIEN UNPAID';
            }
        }

        // ========================================
        // Data Mode Toggle
        // ========================================
        function toggleDataMode() {
            isLiveMode = !isLiveMode;
            const toggle = document.getElementById('dataToggle');
            toggle.classList.toggle('active', isLiveMode);

            if (isLiveMode) {
                console.log('Switching to live Supabase mode...');
                // TODO: Implement Supabase connection
            } else {
                console.log('Switching to demo mode');
            }
        }

        // ========================================
        // Contact Popover
        // ========================================
        let activePopover = null;

        function showContactPopover(button, type, value) {
            // Remove any existing popover
            if (activePopover) {
                activePopover.remove();
                activePopover = null;
            }

            // Create popover
            const popover = document.createElement('div');
            popover.className = 'contact-popover';

            if (type === 'phone') {
                popover.innerHTML = `<a href="tel:${value}">${value}</a>`;
            } else if (type === 'email') {
                popover.innerHTML = `<a href="mailto:${value}">${value}</a>`;
            }

            button.style.position = 'relative';
            button.appendChild(popover);
            activePopover = popover;

            // Close on outside click
            setTimeout(() => {
                document.addEventListener('click', closePopoverOnOutsideClick);
            }, 10);
        }

        function closePopoverOnOutsideClick(e) {
            if (activePopover && !activePopover.contains(e.target) && !e.target.closest('.contact-btn')) {
                activePopover.remove();
                activePopover = null;
                document.removeEventListener('click', closePopoverOnOutsideClick);
            }
        }

        // ========================================
        // Credentials Popup
        // ========================================
        function openCredentialsPopup() {
            loadCredentialsDisplay();
            document.getElementById('credentialsOverlay').classList.add('open');
        }

        function closeCredentialsPopup(event) {
            if (!event || event.target === document.getElementById('credentialsOverlay')) {
                document.getElementById('credentialsOverlay').classList.remove('open');
            }
        }

        function loadCredentialsDisplay() {
            const creds = getStoredCredentials();
            document.getElementById('simplifileUsername').textContent = creds.simplifile?.username || 'Not set';
            // Show masked password or "Not set"
            const pwd = creds.simplifile?.password;
            document.getElementById('simplifilePassword').textContent = pwd ? '' : 'Not set';
            document.getElementById('simplifilePassword').dataset.value = pwd || '';
        }

        function copyCredential(elementId) {
            const element = document.getElementById(elementId);
            let textToCopy;

            if (elementId === 'simplifilePassword') {
                textToCopy = element.dataset.value;
            } else {
                textToCopy = element.textContent;
            }

            if (!textToCopy || textToCopy === 'Not set') {
                alert('No credential set. Please configure in Settings.');
                return;
            }

            navigator.clipboard.writeText(textToCopy).then(() => {
                const btn = element.nextElementSibling;
                btn.textContent = 'Copied!';
                btn.classList.add('copied');
                setTimeout(() => {
                    btn.textContent = 'Copy';
                    btn.classList.remove('copied');
                }, 1500);
            });
        }

        // ========================================
        // Settings Modal
        // ========================================
        function openSettingsModal() {
            closeCredentialsPopup();
            const creds = getStoredCredentials();
            document.getElementById('settingsSimplifileUsername').value = creds.simplifile?.username || '';
            document.getElementById('settingsSimplifilePassword').value = creds.simplifile?.password || '';
            document.getElementById('settingsOverlay').classList.add('open');
        }

        function closeSettingsModal(event) {
            if (!event || event.target === document.getElementById('settingsOverlay')) {
                document.getElementById('settingsOverlay').classList.remove('open');
            }
        }

        function saveSettings() {
            const creds = {
                simplifile: {
                    username: document.getElementById('settingsSimplifileUsername').value,
                    password: document.getElementById('settingsSimplifilePassword').value
                }
            };
            localStorage.setItem('dealOversightCredentials', JSON.stringify(creds));
            closeSettingsModal();
            alert('Settings saved locally.');
        }

        function getStoredCredentials() {
            const saved = localStorage.getItem('dealOversightCredentials');
            return saved ? JSON.parse(saved) : {};
        }

        // ========================================
        // Header Stats
        // ========================================
        function updateHeaderStats() {
            const property = DEMO_PROPERTIES[currentProperty];
            const propNAState = naState[currentProperty] || {};
            const auctionDate = new Date(property.auctionDate);
            const today = new Date();
            today.setHours(0, 0, 0, 0);

            let dueToday = 0;
            let overdue = 0;
            let totalTasks = 0;
            let completedTasks = 0;

            CHECKLIST_SECTIONS.forEach(section => {
                if (section.optionFilter && section.optionFilter !== property.optionType) {
                    return;
                }

                const sectionState = checklistState[currentProperty]?.[section.id] || {};

                section.tasks.forEach(task => {
                    if (propNAState[task.id]) return; // Skip N/A

                    totalTasks++;
                    const isCompleted = sectionState[task.id];
                    if (isCompleted) {
                        completedTasks++;
                        return;
                    }

                    // Calculate due date
                    const dueDate = new Date(auctionDate);
                    dueDate.setDate(dueDate.getDate() + (task.dueOffset || 0));
                    dueDate.setHours(0, 0, 0, 0);

                    const daysUntil = Math.ceil((dueDate - today) / (1000 * 60 * 60 * 24));

                    if (daysUntil < 0) {
                        overdue++;
                    } else if (daysUntil === 0) {
                        dueToday++;
                    }
                });
            });

            const percent = totalTasks > 0 ? Math.round((completedTasks / totalTasks) * 100) : 0;

            document.querySelector('#statDueToday .stat-value').textContent = dueToday;
            document.querySelector('#statOverdue .stat-value').textContent = overdue;
            document.querySelector('#statComplete .stat-value').textContent = percent + '%';

            // Update stat item styling
            const overdueItem = document.getElementById('statOverdue');
            if (overdue > 0) {
                overdueItem.classList.add('urgent');
            } else {
                overdueItem.classList.remove('urgent');
            }
        }

        // ========================================
        // Google Maps Link
        // ========================================
        function getGoogleMapsUrl() {
            const property = DEMO_PROPERTIES[currentProperty];
            const fullAddress = `${property.address}, ${property.city}, ${property.state} ${property.zip}`;
            const encodedAddress = encodeURIComponent(fullAddress);
            return `https://www.google.com/maps/search/?api=1&query=${encodedAddress}`;
        }

        function openGoogleMaps(event) {
            event.preventDefault();
            const mapsUrl = getGoogleMapsUrl();
            window.open(mapsUrl, '_blank');
        }

        function updateGoogleMapsLink() {
            // Kept for compatibility but onclick handler now handles navigation
            const mapsUrl = getGoogleMapsUrl();
            document.getElementById('propertyAddressLink').setAttribute('data-maps-url', mapsUrl);
        }

        // ========================================
        // Recording Deed Simplifile Link
        // ========================================
        function openSimplifileWithCredentials(event) {
            event.preventDefault();
            event.stopPropagation();
            openCredentialsPopup();
        }

        // ========================================
        // Update Load Property to include new features
        // ========================================
        const originalLoadProperty = loadProperty;
        loadProperty = function(propertyId) {
            originalLoadProperty(propertyId);
            updateHeaderStats();
            updateGoogleMapsLink();

            // Update title company based on option
            const property = DEMO_PROPERTIES[propertyId];
            const titleSection = document.getElementById('titleCompanySection');
            const titleOptionLabel = document.getElementById('titleOptionLabel');
            const titleContactName = document.getElementById('titleContactName');
            const titleCompanyName = document.getElementById('titleCompanyName');
            const titleCompanyContact = document.getElementById('titleCompanyContact');

            if (property.optionType === 'option_1') {
                titleOptionLabel.textContent = 'Option 1';
                titleContactName.textContent = 'Cathy L Morrison';
                titleCompanyName.textContent = 'IPC';
                // Update phone/email buttons
                const buttons = titleCompanyContact.querySelectorAll('.contact-btn');
                buttons[0].setAttribute('onclick', "showContactPopover(this, 'phone', '863-732-8485')");
                buttons[1].setAttribute('onclick', "showContactPopover(this, 'email', 'Cathy@ipcpolk.com')");
            } else {
                titleOptionLabel.textContent = 'Option 2';
                titleContactName.textContent = 'Meaghan Dubbs';
                titleCompanyName.textContent = 'University Title';
                const buttons = titleCompanyContact.querySelectorAll('.contact-btn');
                buttons[0].setAttribute('onclick', "showContactPopover(this, 'phone', '602-903-4914')");
                buttons[1].setAttribute('onclick', "showContactPopover(this, 'email', 'mdubbs@u-titleagency.com')");
            }

            // Show/hide probate attorney based on isProbate
            const probateCard = document.getElementById('probateAttorneyCard');
            if (probateCard) {
                probateCard.style.display = property.isProbate ? 'flex' : 'none';
            }

            // Update accepted/closes dates
            document.getElementById('acceptedDate').textContent =
                new Date(property.acceptedDate).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
            document.getElementById('closesDate').textContent =
                new Date(property.closesDate).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
        };

        // Update overall progress to also update header stats
        const originalUpdateOverallProgress = updateOverallProgress;
        updateOverallProgress = function() {
            originalUpdateOverallProgress();
            updateHeaderStats();
        };

        // Initialize on load
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
